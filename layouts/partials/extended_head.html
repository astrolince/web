<!-- Language preference handling -->
<script>
  const SUPPORTED_LANGUAGES = ["en", "es"];
  const DEFAULT_LANGUAGE = "en";
  const COOKIE_NAME = "preferredLanguage";
  const COOKIE_EXPIRY_DAYS = 365;
  const COOKIE_SETTINGS = {
    path: "/",
  };

  const setCookie = (name, value, days) => {
    const expires = new Date(Date.now() + days * 864e5).toUTCString();
    const cookieValue = encodeURIComponent(value);
    const cookieString = Object.entries({
      ...COOKIE_SETTINGS,
      expires,
    })
      .map(([key, val]) => `${key.toLowerCase()}=${val}`)
      .join("; ");

    document.cookie = `${name}=${cookieValue}; ${cookieString}`;
  };

  const getCookie = (name) => {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    return parts.length === 2 ? parts.pop().split(";").shift() : null;
  };

  const setLanguageCookie = (lang) => {
    if (SUPPORTED_LANGUAGES.includes(lang)) {
      setCookie(COOKIE_NAME, lang, COOKIE_EXPIRY_DAYS);
    }
  };

  const getPreferredLanguage = () => {
    // Check cookie first
    const cookieLang = getCookie(COOKIE_NAME);
    if (SUPPORTED_LANGUAGES.includes(cookieLang)) {
      return cookieLang;
    }

    // Then check browser language
    const browserLang = navigator.language?.toLowerCase()?.split("-")[0];
    return SUPPORTED_LANGUAGES.includes(browserLang)
      ? browserLang
      : DEFAULT_LANGUAGE;
  };

  // Handle language redirection
  const path = window.location.pathname;
  const preferredLang = getPreferredLanguage();

  // Only redirect if preferred language is Spanish and path doesn't start with /es/
  if (preferredLang === "es" && !path.startsWith("/es/")) {
    window.location.replace(`/es${path}`);
  }
</script>

<!-- Title cursor blink effect -->
<script>
  const BLINK_TIME = 530;
  const TITLE_CONFIG = {
    lastChar: document.title.slice(-1),
    baseTitle: document.title.slice(0, -1),
    spaceChar: " ",
  };

  const updateTitle = () => {
    const { lastChar, baseTitle, spaceChar } = TITLE_CONFIG;
    document.title = document.title.endsWith(lastChar)
      ? baseTitle + spaceChar
      : baseTitle + lastChar;
  };

  // Start blinking
  setInterval(updateTitle, BLINK_TIME);
</script>

<!-- Oneko (cat) cursor follower -->
<script src="/oneko.js" defer></script>
